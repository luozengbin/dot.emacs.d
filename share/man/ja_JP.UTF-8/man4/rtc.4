.\" rtc.4
.\" Copyright 2002 Urs Thuermann (urs@isnogud.escape.de)
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111,
.\" USA.
.\"
.\" $Id: rtc.4,v 1.4 2005/12/05 17:19:49 urs Exp $
.\"
.\" 2006-02-08 Various additions by mtk
.\" 2006-11-26 cleanup, cover the generic rtc framework; David Brownell
.\"
.\" Japanese Version Copyright (c) 2006-2007 Yuichi SATO
.\"         all rights reserved.
.\" Translated 2006-07-12 by Yuichi SATO <ysato444@yahoo.co.jp>. LDP v2.29
.\" Updated & Modified 2007-01-08 by Yuichi SATO. LDP v2.43
.\"
.TH RTC 4 2010-02-25 "Linux" "Linux Programmer's Manual"
.SH 名前
rtc \- ≪帥ゃク
.SH 後
#include <linux/rtc.h>
.sp
.BI "int ioctl(" fd ", RTC_" request ", " param ");"
.SH 茯
これ≪帥ゃク (RTC) ゃゃ潟帥с若鴻сる。

紊く潟潟ャ若帥憜紕時荐」時刻 ("wall clock" time) を荐蚊る、
ハ若с≪ 1 個篁ヤ持ｃる。
これら≪帥ゃ(RTC) 若違る。
これら荐ち 1 ゃ通絽吾紙сッ≪プし動されるс
潟潟ャ若帥鴻ゃチを切ｃ、時祉篆持сる。
紊く翫、RTC ≪若やそ蚊莨若帥純提箴する。

 i386 PC と ACPI ベ若鴻激鴻ム RTC がある。
この RTC 元々の PC/AT た
Motorola MC146818 チップ換сある。
こうな RTC 篁ャс吟若若の
チップ祉ト (泣鴻ジ) 内у茖されるこ紊く、
篋ゆ純゜莢らいぇきさッ≪プ紙を篏帥ｃる。

激鴻ム潟ップ (system-on-chip) プ祉泣篏帥ｃられた
腟粋昭帥激鴻ムｃ、PC 篁ュ激鴻ムсャ茖をる。
こう激鴻ムсPC/AT の RTC じ罘純提箴し翫が紊い。

.SS RTC 激鴻ムい
RTC を激鴻ム祁同す鴻с。
激鴻ム若理される純トс≪сり、
フ＜ゃる帥ゃ鴻帥潟荐
.BR gettimeofday (2)
や
.BR time (2)
を絎茖する戎れる。
激鴻ムPOSIX ける膣元
(Epoch; 1970-01-01 00:00:00 +0000 (UTC)) からを茵。
1 ゃ茖с帥ゃ弱蚊莨若帥、"jiffy" 罸に 1 回、
100, 250, 1000 Hz う晦違с潟する。

RTC 激鴻ム荀い
RTC 激鴻ムが篏糸倶 (「」翫も) с動篏するし、
激鴻ム篏し鴻сる。
激鴻ム初期化が茵われる障с
POSIX 膣元からс激鴻ム若時から祉か菴せ。
そめ、ブ若時や激鴻ム糸倶から奨絽 (resume) 緇
激鴻ム RTC を篏帥ｃ憜時荐時祉┃絎される翫が紊い。
RTC を持た激鴻ムс
篁荐を篏帥ｃ激鴻ム荐する綽荀があり、
ネット若≪祉鴻たり、(時刻) デ若帥手動уュしたりするだろう。
.SS RTC 能
RTC は
.BR hwclock (8)
障荐の ioctl 鴻ц炊吾がсる。

ヤ間を潟するえ
紊くの RTC 札筝う蚊莨若帥榊сる。
.IP * 3
贋井 (ゃ障 1 腱罸ｩ。
.IP *
2 Hz から 8192 Hz 障с 2 違晦違с絎期的隔。
.IP *
前もｃ絎した≪若時祉した時。
.PP
これら蚊莨若水個ャ鴻たり≦鴻たりсる。
紊く激鴻ムс≪若蚊莨若帥激鴻ムの
сゃ≪プゃ潟┃絎сる。
こゃ潟RAM 吾泣鴻潟 (STR, ACPI 激鴻ムで S3 若違る) や
ハゃ若若激с (ACPI 激鴻ムで S4 若違る) ｃ篏糸倶や、
「」(ACPI 激鴻ムで S5 若違る) からс、激鴻ムを緇鍵сる。
紙сッ≪プされた RTC が蚊莨若帥榊сる激鴻ム
с激鴻ムがある。

.I /dev/rtc
(障は
.IR /dev/rtc0 ,
.I /dev/rtc1
)
デバゃ鴻 (若冴れる障) 1 回しか若潟るこсず、
茯粋昭水сる。
.BR read (2)
と
.BR select (2)
を若喝冴たプ祉鴻
RTC から蚊莨若帥受け取る障у罩 (block) される。
蚊莨若帥、プ祉鴻 long 型贋違茯水冴こсる。
こ贋違筝篏バゃ榊した蚊莨若帥┏ャ
潟若化したビットマ鴻сり、
罧りの 3 バゃ緇の
.BR read (2)
篁ラ榊した蚊莨若帥違сる。
.SS ioctl(2) ゃ潟帥с若
篁ヤの
.BR ioctl (2)
鴻が RTC デバゃ鴻･膓された
フ＜ゃｃ鴻帥し臂れる:
.TP
.B RTC_RD_TIME
RTC 祉篁ヤ造篏цす:
.IP
.in +4n
.nf
struct rtc_time {
    int tm_sec;
    int tm_min;
    int tm_hour;
    int tm_mday;
    int tm_mon;
    int tm_year;
    int tm_wday;     /* 戎用 */
    int tm_yday;     /* 戎用 */
    int tm_isdst;    /* 戎用 */
};
.fi
.in
.IP
こ造篏ｃ若は
.BR gmtime (3)
ц明される
.I tm
罕造篏ｃ若じ意潟уじ膀蚊сる。
こ造篏吾ゃ潟帥
.BR ioctl (2)
 3 綣き違検す。
.TP
.B RTC_SET_TIME
.BR ioctl (2)
 3 綣き違指す
.I rtc_time
罕造篏ゃ RTC 時祉┃絎する。
RTC 時祉┃絎する翫、プ祉鴻号┤
(ゃ障
.B CAP_SYS_TIME
宴若ビィ) を持たれ違。
.TP
.BR RTC_ALM_READ ", " RTC_ALM_SET
≪若が泣若される RTC し
≪若時祉粋昭帥┃絎を茵う。
≪若蚊莨若帥
.BR RTC_AIE_ON ", " RTC_AIE_OFF
を篏帥ｃこれャ鴻障≦鴻れ違。
\fBioctl\fP(2)  3 綣き違
.I rtc_time
罕造篏吾ゃ潟帥сれ違。
こ造篏の
.IR tm_sec ,
.IR tm_min ,
.I tm_hour
フｃ若帥篏睡れる。
.TP
.BR RTC_IRQP_READ ", " RTC_IRQP_SET
的蚊莨若帥泣若される RTC し
的蚊莨若帥晦違粋昭帥┃絎を茵う。
的蚊莨若帥
.BR RTC_PIE_ON ", " RTC_PIE_OFF
を篏帥ｃこれャ鴻障≦鴻れ違。
\fBioctl\fP(2)  3 綣き違それぞれ
.I "unsigned long\ *"
と
.I "unsigned long"
сる。
こゃ 1 腱綵たり蚊莨若帥違сる。
指絎純晦違2 違 2 から 8192 蚊сる。
号┤プ祉 (ゃ障
.B CAP_SYS_RESOURCE
宴若ビｃ持ゃ祉) 帥、
.I /proc/sys/dev/rtc/max-user-freq
吾れた筝荐晦違荐сる。
(こ＜ゃフで 64 うゃ吾れる)。
.TP
.BR RTC_AIE_ON ", " RTC_AIE_OFF
≪若が泣若される RTC し
≪若蚊莨若帥有鴻障≦鴻る。
\fBioctl\fP(2)  3 綣き違∴される。
.TP
.BR RTC_UIE_ON ", " RTC_UIE_OFF
1 腱罸蚊莨若帥泣若される RTC し
贋井蚊莨若帥有鴻障≦鴻る。
\fBioctl\fP(2)  3 綣き違∴される。
.TP
.BR RTC_PIE_ON ", " RTC_PIE_OFF
的蚊莨若帥泣若される RTC し
的蚊莨若帥有鴻障≦鴻る。
\fBioctl\fP(2)  3 綣き違∴される。
号┤プ祉 (ゃ障
.B CAP_SYS_RESOURCE
宴若ビｃ持ゃ祉) 帥、
そ鴻
.I /proc/sys/dev/rtc/max-user-freq
が筝荐ゃ絎される翫
的蚊莨若帥有鴻сる。
.TP
.BR RTC_EPOCH_READ ", " RTC_EPOCH_SET
紊くの RTC 拘を 8 ビット吾鴻帥潟若化する。
綛眼 8 ビットゃ違障は BCD 違換される。
＜翫с、そ医ゃ RTC 元から後ゃ換される。
紊く激鴻ムс RTC 元は 1900 期化されるが、
Alpha と MIPS сRTC 吾鴻帥拘ゃじ
1952, 1980, 2000 れか期化される。
これら篏сれぞれ RTC 元粋昭帥┃絎が純 RTC もある。
\fBioctl\fP(2)  3 綣き違それぞれ
.I "unsigned long\ *"
と
.I "unsigned long"
сる。
菴される値 (障絎される値) 元сる。
RTC 元を荐する翫、プ祉鴻号┤ (ゃ障
.B CAP_SYS_TIME
宴若ビィ) を持たれ違。
.TP
.BR RTC_WKALM_RD ", " RTC_WKALM_SET
RTC 賢り綣桁≪若ゃ潟帥с若鴻泣若するもあり、
これらの ioctl を篏帥こс篁ヤう造篏で
RTC ≪若時祉 (それぞれ) 茯炊吾сる:
.PP
.RS
.in +4n
.nf
struct rtc_wkalrm {
    unsigned char enabled;
    unsigned char pending;
    struct rtc_time time;
};
.fi
.in
.RE
.IP
.I enabled
フ違≪若蚊莨若帥有鴻障≦鴻たり、
憜倶を茯粋昭む戎れる。
これら違篏帥翫、
.BR RTC_AIE_ON " と " RTC_AIE_OFF
戎れ。
.I pending
フ違
.B RTC_WKALM_RD
т戎れ、緇＜蚊莨若帥茵ずする
(EFI フ＜若с≪х理される RTC 篆＜る篁ュ、
Linux с祉醜た)。
.I time
フｃ若は
.B RTC_ALM_READ
や
.B RTC_ALM_SET
翫じよう戎れるが、
.IR tm_mday ,
.IR tm_mon ,
.I tm_year
フｃ若も有鴻сるう鴻違。
こ造篏吾ゃ潟帥
.BR ioctl (2)
 3 綣き違検され違。
.SH フ＜ゃ
.IR /dev/rtc ", "
.IR /dev/rtc0 ", "
.I /dev/rtc1
:
RTC 号ｃ帥若バゃ鴻＜ゃ

.IR /proc/driver/rtc :
(1 ょ) RTC 倶
.SH 羈
若激鴻ム
.BR adjtimex (2)
を篏帥ｃсу期させる翫、
.BR adjtimex (2)
絎された RTC を 11 分罸期的贋違る。
これを茵うため若的蚊莨若帥間≦鴻る綽荀がある。
これは RTC を篏帥プ違襲帥筝える。

RTC 元激鴻ムс推戎れる
POSIX 元≫も。

RTC 元拘吾鴻帥冴ャ鎶眼 1970 сる翫、
100 綛翫、ゃ障 2000 から 2069 сる皿絎される。

RTC 賢≪若フｃ若に
「ゃ若」ゃ泣若するもあり、
罸時 15 分や各月ャ絎期的≪若を茵う激泣若する。
こう戎い鴻Щ罎с。
腱紙сい若句間潟若с単≪若蚊莨若帥けを喝し、
蚊莨若帥篆≦≪若を≦鴻障初期化す鴻сる。

篁ヤ純泣若する RTC もある。
1 腱違с、1 腱違る的蚊莨若帥
茲違≪若。
プ違純阪激違
筝堺 (nonvolatile) ＜≪
この API х憜箴し、そ若с∽純
.SH ∫ｉ目
.BR date (1),
.BR adjtimex (2),
.BR gettimeofday (2),
.BR settimeofday (2),
.BR stime (2),
.BR time (2),
.BR gmtime (3),
.BR time (7),
.BR hwclock (8),
/usr/src/linux/Documentation/rtc.txt
