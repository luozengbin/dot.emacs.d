.\" Copyright 2002 Walter Harms <walter.harms@informatik.uni-oldenburg.de>
.\" and Andries Brouwer <aeb@cwi.nl>.
.\" Distributed under GPL.
.\"
.\" Japanese Version Copyright (c) 2004 Yuichi SATO
.\"         all rights reserved.
.\" Translated Sat Oct 16 06:08:24 JST 2004
.\"         by Yuichi SATO <ysato444@yahoo.co.jp>
.\"
.TH TTY_IOCTL 4 2008-10-29 "Linux" "Linux Programmer's Manual"
.SH 名前
tty_ioctl \- 腴激≪ゃ潟 ioctl (ュ阪九勝)
.SH 後
.B "#include <termios.h>"
.sp
.BI "int ioctl(int " fd ", int " cmd ", ...);"
.SH 茯
腴激≪若ゃ
.BR ioctl (2)
潟若紊く潟潟綣き違受け篁ける。
紊くがいろいろの 3 き違綽荀る。
ここс \fIargp\fP 障は \fIarg\fP 若吟
.LP
.I ioctl
を篏睡るЩ罎сプ違。
純翫
.BR termios (3)
菴違れる POSIX ゃ潟帥с若鴻篏帥こ
.SS 腴с緇┃絎
.TP
.BI "TCGETS	struct termios *" argp
.I "tcgetattr(fd, argp)"
じ。
.br
憜激≪若┃絎を取緇する。
.TP
.BI "TCSETS	const struct termios *" argp
.I "tcsetattr(fd, TCSANOW, argp)"
じ。
.br
憜激≪若┃絎を紊眼る。
.TP
.BI "TCSETSW	const struct termios *" argp
.I "tcsetattr(fd, TCSADRAIN, argp)"
じ。
.br
排出 (drain) を茵うため阪バッフ＜戎荐怨、
憜激≪若┃絎を紊眼る。
.TP
.BI "TCSETSF	const struct termios *" argp
.I "tcsetattr(fd, TCSAFLUSH, argp)"
じ。
.br
排出 (drain) を茵うため阪バッフ＜戎荐怨、
しュを贋し
憜激≪若┃絎を紊眼る。
.LP
篁ヤの 4 ゃ ioctl は
.BR TCGETS ,
.BR TCSETS ,
.BR TCSETSW ,
.B TCSETSF
室る。
ただし、
.I "struct termios *"
撮わりに
.I "struct termio *"
を取る。
.TP
.BI "TCGETA	struct termio *" argp
.TP
.BI "TCSETA	const struct termio *" argp
.TP
.BI "TCSETAW	const struct termio *" argp
.TP
.BI "TCSETAF	const struct termio *" argp
.SS "termios 罕造篏ク"
腴
.I termios
罕造篏るこ純сる。
こは
.I termios
罕造篏сり、
0 сビット障ｃ若れたゃ腓冴。
.TP
.BI "TIOCGLCKTRMIOS	struct termios *" argp
腴
.I termios
罕造篏倶を取緇する。
.TP
.BI "TIOCSLCKTRMIOS	const struct termios *" argp
腴
.I termios
罕造篏倶を荐する。
root  (より罩ｇ∈
.B CAP_SYS_ADMIN
宴若ビｃ持ゃ祉) がこれを絎茵сる。
.SS ｃ潟泣ゃ冴緇┃絎
ｃ潟泣ゃ冴若持されるが、
若ｃ戎れ
(篁潟潟潟純若翫紊сり、違いフ潟を茯粋昭んだ翫
篁括泣ゃ冴紊眼れた翫、若ｃ潟泣ゃ冴贋違る)。

篁ヤ違造篏は
.I <sys/ioctl.h>
у臂れる。
.TP
.BI "TIOCGWINSZ	struct winsize *" argp
ｃ潟泣ゃ冴取緇する。
.TP
.BI "TIOCSWINSZ	const struct winsize *" argp
ｃ潟泣ゃ冴荐する。
.LP
これらの ioctl т戎れる罕造篏篁ヤう臂れる。

.in +4n
.nf
struct winsize {
    unsigned short ws_row;
    unsigned short ws_col;
    unsigned short ws_xpixel;   /* 戎用 */
    unsigned short ws_ypixel;   /* 戎用 */
};
.fi
.in

ｃ潟泣ゃ冴紊眼れた翫、
フ≪違潟プ祉鴻違若に
.B SIGWINCH
激違送られる。
.SS "break 篆"
.TP
.BI "TCSBRK	int " arg
.I "tcsendbreak(fd, arg)"
じ。
.br
腴非同期激≪若粋拶送を篏睡り、
.I arg
が 0 翫、0.25 から 0.5 腱に
break (0 ット列鴻若) が送篆＜れる。
腴非同期激≪若粋拶送を篏睡る翫、
break が送篆＜れるか、こ∽違もせずる。
.I arg
が 0 篁ュ翫、篏が莎激るか分から。

(SVr4, UnixWare, Solaris, Linux 
.I "tcsendbreak(fd,arg)"
の
.I arg
が 0 篁ュ翫、
.I "tcdrain(fd)"
う宴。
SunOS は
.I arg
を倍違宴、ビット鴻若を
.I arg
回送篆＜る。
.I arg
が 0 翫も同じ。
DG/UX と AIX (0 篁ュ翫)
.I arg
をミ単篏間間隔宴。
HP-UX は
.I arg
を∴する。)
.TP
.BI "TCSBRKP	int " arg
いわゆる「POSIX 版」の
.B TCSBRK
сる。
これは 0 篁ュの
.I arg
を 1/10 腱単篏間間隔宴。
障ドゃが break を泣若し翫篏もし。
.TP
.B "TIOCSBRK	void"
break を潟る。
ゃ障 0 ット列篆＜開紮する。
.TP
.B "TIOCCBRK	void"
break をる。
ゃ障 0 ット列篆＜停罩≪る。
.SS 純トс≪弱九勝
.TP
.BI "TCXONC	int " arg
.I "tcflow(fd, arg)"
じ。
.br
.BR tcflow (3)
き数
.BR TCOOFF ,
.BR TCOON ,
.BR TCIOFF ,
.B TCION
を参сるこ
.SS "バッフ＜潟吾冴 (flush)"
.TP
.BI "FIONREAD	int *" argp
ュバッフ＜るバゃ違取緇する。
.TP
.BI "TIOCINQ	int *" argp
.B FIONREAD
じ。
.TP
.BI "TIOCOUTQ	int *" argp
阪バッフ＜るバゃ違取緇する。
.TP
.BI "TCFLSH	int " arg
.I "tcflush(fd, arg)"
じ。
.br
.BR tcflush (3)
き数
.BR TCIFLUSH ,
.BR TCOFLUSH ,
.B TCIOFLUSH
を参сるこ
.SS ュ処
.TP
.BI "TIOCSTI	const char *" argp
指絎されたバゃをュャ若水ャる。
.SS 潟潟純若阪ゃ
.TP
.B "TIOCCONS	void"
.I /dev/console
障は
.I /dev/tty0
られる阪を、指絎された腴ゃする。
指絎された腴疑篌主末 (pseudoterminal) 鴻帥翫、
阪鴻若られる。
バ若吾с 2.6.10 より前の Linux с阪が障ゃされて
いれ違茯違сゃを茵うこсる。
バ若吾с 2.6.10 篁ラсroot
.RB ( CAP_SYS_ADMIN
宴若ビｃ持ゃ祉) だけがゃを茵うこсる。
阪がすсゃされる翫は
.B EBUSY
が菴されるが、
.I /dev/console
か
.I /dev/tty0
を指しる
.I fd
しの ioctl を篏睡るこсゃを罩≪るこсる。
.SS "腴九勝"
.TP
.BI "TIOCSCTTY	int " arg
指絎された腴若喝冴元祉鴻九勝腴る。
若喝冴元祉鴻祉激с潟若сれ違ず、
かゆ≪九勝腴持ｃ。
こ≪祉激с潟違若九勝腴сる翫、
ioctl は
.B EPERM
уけ敗する。ただし若喝冴た若吟 root で
(より罩ｇ∈
.B CAP_SYS_ADMIN
宴若ビｃ持ｃて)、かつ
.I arg
が 1 сる翫をゃ。
こ翫、腴障 (stolen)、
こ九勝腴た祉鴻紊宴。
.TP
.B TIOCNOTTY	void
指絎された腴若喝冴元祉鴻九勝腴сる翫、
こ九勝腴丈する。
プ祉鴻祉激с潟若翫、
フ≪違潟プ祉鴻違若に
.B SIGHUP
と
.B SIGCONT
を送り、潟祉激с潟祉鴻九勝腴紊宴。
.SS "違若 ID 祉激с ID "
.TP
.BI "TIOCGPGRP	pid_t *" argp
成功した翫、
.I "*argp = tcgetpgrp(fd)"
じ。
.br
こ≪違潟プ祉鴻祉鴻違若 ID を取緇する。
.TP
.BI "TIOCSPGRP	const pid_t *" argp
.I "tcsetpgrp(fd, *argp)"
じ。
.br
こ≪違潟プ祉鴻違若 ID を荐する。
.TP
.BI "TIOCGSID	pid_t *" argp
指絎された腴祉激с ID を取緇する。
腴マ鴻睡篌主障九勝腴с翫
.B ENOTTY
уけ敗する。
絅絋だ。
.SS 排篁≪若
.TP
.B "TIOCEXCL	void"
腴排篁≪若る。
腴しこれ篁ラの
.BR open (2)
操篏を胼罩≪る。
(root 篁ュ翫、ゃ障
.B CAP_SYS_ADMIN
宴若ビｃ持たプ祉鴻翫、これ篁ラの
.BR open (2)
は
.B EBUSY
уけ敗する。)
.TP
.B "TIOCNXCL	void"
排篁≪若を≦鴻る。
.SS "ゃ喝九勝 (line discipline)"
.TP
.BI "TIOCGETD	int *" argp
腴ゃ喝九勝宴取緇する。
.TP
.BI "TIOCSETD	const int *" argp
腴ゃ喝九勝宴荐する。
.SS "疑篌主 ioctl"
.TP
.BI "TIOCPKT	const int *" argp
パ宴ト≪若を有効
.RI (* argp
が 0 篁ュ翫) 障≦鴻る。
疑篌主鴻水眼翠сる (それ篁ュ翫は
.B ENOTTY
を菴す)。
パ宴ト≪若сそ茵される
.BR read (2)
ゃ 0 篁ュの 1 ゃ九勝バゃをパ宴トか、
ゃ 0 の 1 バゃ (\(aq\\0\(aq) 篌主鴻若眼ф吾莨若障た
デ若帥膓くパ宴トを菴す。
最初ゃが
.B TIOCPKT_DATA
(0) с翫、篁ヤットの 1 や札筝を OR したもсる:

.nf
TIOCPKT_FLUSHREAD   腴粋昭帥ャ若フ激 (flush) される。
TIOCPKT_FLUSHWRITE  腴吾冴ャ若フ激ャれる。
TIOCPKT_STOP        腴吾阪が停罩≪れる。
TIOCPKT_START       腴吾阪が再開される。
TIOCPKT_DOSTOP      開紮文絖篋文絖が \fB^S\fP/\fB^Q\fP сる。
TIOCPKT_NOSTOP      開紮文絖篋文絖が \fB^S\fP/\fB^Q\fP с。
.fi

こ≪若が篏帥れる翫、
九勝倶情宴マ鴻水眼ら茯粋昭めるか
箴紊的＞散で
.BR select (2)
を篏帥こりャこсる。

こ≪若は
.BR rlogin (1)
と
.BR rlogind (8)
т戎われ、≪若潟若≪若違ゃ潟
若с \fB^S\fP/\fB^Q\fP フ弱九勝≪若違ゃ潟絎茖しる。

BSD の ioctl сる
.BR TIOCSTOP ,
.BR TIOCSTART ,
.BR TIOCUCNTL ,
.B TIOCREMOTE
Linux с茖され。
.SS ≪ム九勝
.TP
.BI "TIOCMGET	int *" argp
≪ムビット列倶を取緇する。
.TP
.BI "TIOCMSET	const int *" argp
≪ムビット列倶を荐する。
.TP
.BI "TIOCMBIC	const int *" argp
指絎された≪ムビット列を≪る。
.TP
.BI "TIOCMBIS	const int *" argp
指絎された≪ムビット列を荐する。
.LP
これらの 4 ゃ ioctl т戎われるビット札筝り:

.nf
TIOCM_LE        DSR (data set ready/line enable)
TIOCM_DTR       DTR (data terminal ready)
TIOCM_RTS       RTS (request to send)
TIOCM_ST        Secondary TXD (transmit)
TIOCM_SR        Secondary RXD (receive)
TIOCM_CTS       CTS (clear to send)
TIOCM_CAR       DCD (data carrier detect)
TIOCM_CD         TIOCM_CAR を参с
TIOCM_RNG       RNG (ring)
TIOCM_RI         TIOCM_RNG を参с
TIOCM_DSR       DSR (data set ready)
.fi
.SS "回膩を若若る"
.TP
.BI "TIOCGSOFTCAR	int *" argp
("純トс≪ｃ≪違緇")
.I termios
罕造篏の c_cflag フｃ若の
.B CLOCAL
フ違倶を取緇する。
.TP
.BI "TIOCSSOFTCAR	const int *" argp
("純トс≪ｃ≪違┃絎")
.RI * argp
が 0 篁ュ翫、
.I termios
罕造篏の
.B CLOCAL
フ違荐する。
0 翫≪る。
.LP
ゃ潟
.B CLOCAL
フ違翫、
ハ若с≪ｃ∽出 (hardware carrier detect, DCD) 激違重荀сり、
.B O_NONBLOCK
フ違指絎され限り、絲上する腴
.BR open (2)
は DCD が腓冴れる障сれる。
.B CLOCAL
が荐される翫、
ゃ潟幻に DCD が腓冴れるかう篏する。
純トс≪ｃ≪違若バゃ鴻с絽吾潟ｃり、
≪ムゃ潟сｃる。
.SS "Linux 堺の ioctl"
.B TIOCLINUX
ioctl ゃ
.BR console_ioctl (4)
を参сるこ
.SS 若バッ潟
.B "#include <linux/tty.h>"
.TP
.BI "TIOCTTYGSTRUCT	struct tty_struct *" argp
.I fd
綽する
.I tty_struct
を取緇する。
.\" .SS "激≪報"
.\" .BR "#include <linux/serial.h>"
.\" .sp
.\" .TP
.\" .BI "TIOCGSERIAL	struct serial_struct *" argp
.\" 激≪宴取緇する。
.\" .TP
.\" .BI "TIOCSSERIAL	const struct serial_struct *" argp
.\" 激≪宴荐する。
.SH 菴り値
.BR ioctl (2)
激鴻ム潟若成功した翫は 0 を菴す。
若翫は \-1 を菴し、
.I errno
を┃絎する。
.SH 
.TP
.B EINVAL
筝罩ｃ潟潟綣き違сる。
.TP
.B ENOIOCTLCMD
筝明潟潟сる。
.TP
.B ENOTTY
.I fd
が筝сる。
.TP
.B EPERM
罔が筝莇潟る。
.SH 箴
激≪若の DTR 倶をチсる。

.nf
#include <termios.h>
#include <fcntl.h>
#include <sys/ioctl.h>

int
main(void)
{
    int fd, serial;

    fd = open("/dev/ttyS0", O_RDONLY);
    ioctl(fd, TIOCMGET, &serial);
    if (serial & TIOCM_DTR)
        puts("TIOCM_DTR が荐され。");
    else
        puts("TIOCM_DTR が荐される。");
    close(fd);
}
.fi
.SH ∫ｉ目
.BR ioctl (2),
.BR termios (3),
.BR console_ioctl (4),
.BR pty (7)
.\"
.\" FIONBIO			const int *
.\" FIONCLEX			void
.\" FIOCLEX			void
.\" FIOASYNC			const int *
.\" serial.c より:
.\" TIOCSERCONFIG		void
.\" TIOCSERGWILD		int *
.\" TIOCSERSWILD		const int *
.\" TIOCSERGSTRUCT		struct async_struct *
.\" TIOCSERGETLSR		int *
.\" TIOCSERGETMULTI		struct serial_multiport_struct *
.\" TIOCSERSETMULTI		const struct serial_multiport_struct *
.\" TIOCGSERIAL, TIOCSSERIAL (筝荐を参照)
