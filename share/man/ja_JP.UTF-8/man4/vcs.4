.\" Copyright (c) 1995 James R. Van Zandt <jrv@vanzandt.mv.com>
.\" Sat Feb 18 09:11:07 EST 1995
.\"
.\" This is free documentation; you can redistribute it and/or
.\" modify it under the terms of the GNU General Public License as
.\" published by the Free Software Foundation; either version 2 of
.\" the License, or (at your option) any later version.
.\"
.\" The GNU General Public License's references to "object code"
.\" and "executables" are to be interpreted as the output of any
.\" document formatting or typesetting system, including
.\" intermediate and printed output.
.\"
.\" This manual is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public
.\" License along with this manual; if not, write to the Free
.\" Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111,
.\" USA.
.\"
.\" Modified, Sun Feb 26 15:08:05 1995, faith@cs.unc.edu
.\" 2007-12-17, Samuel Thibault <samuel.thibault@ens-lyon.org>:
.\"     document the VT_GETHIFONTMASK ioctl
.\" "
.\" Japanese Version Copyright (c) 1996,1997,1998 ISHIKAWA Mutsumi
.\"         all rights reserved.
.\" Translated Tue Feb 6 16:30:31 JST 1997
.\"         by ISHIKAWA Mutsumi <ishikawa@linux.or.jp>
.\"
.\" Japanese Version Last Modified Sun Jan 11 03:55:54 1998
.\"	by ISHIKAWA Mutsumi <ishikawa@linux.or.jp>
.\" Updated Sat Feb 10 23:17:30 JST 2001
.\"	by Yuichi SATO <sato@complex.eng.hokudai.ac.jp>
.\" Updated 2008-02-12, Akihiro MOTOKI <amotoki@dd.iij4u.or.jp>, LDP v2.77
.\"
.\" WORD:	virtual console		ç¯õ€”‹ƒæ½Ÿ‚æ½Ÿƒæ½Ÿ‚ç´”ƒè‹¥ƒ«
.\" WORD:	memory			ãƒï¼œƒâ‰ªƒª
.\" WORD:	permission		ãƒ‘ãƒè‹¥ƒŸãƒƒã‚æ¿€ƒÑƒ³
.\" WORD:	prefix			ãƒ—ãƒõ€‘Œƒ•ã‚ï½ƒƒƒã‚õ€•¦‚¹
.\" WORD:	screen			ã‚é´»‚õ€•¦ƒõ€ƒè‹¥ƒ³
.\" WORD:	cursor			ã‚õ€®ƒè‹¥‚ç´”ƒ«
.\" WORD:	Braille			ãƒ–ãƒõ€Œ²‚ã‚ƒƒõ€ˆœ‚åŠ«­—
.\"
.TH VCS 4 2007-12-17 "Linux" "Linux Programmer's Manual"
.SH åå‰
vcs, vcsa \- ç¯õ€”‹ƒæ½Ÿ‚æ½Ÿƒæ½Ÿ‚ç´”ƒè‹¥ƒõ€®ƒï¼œƒâ‰ªƒª (virtual console memory)
.SH èŒ¯õ€‘˜
\fI/dev/vcs0\fP ãõ€•¦ƒï¼œ‚å¾ƒï½ƒƒè‹¥ƒŠãƒæ½Ÿƒãƒ¼ (major number) 7ã€ãƒã‚ã‚ƒƒŠãƒè‹¥ƒŠãƒæ½Ÿƒãƒ¼
(minor number) 0 ãõ€”ˆ‚õ€’ªƒï½ƒƒõ€Œ²‚õ€•¦‚å¸¥ƒè‹¥ƒ‡ãƒã‚ã‚ƒ‚¹ (character device) ãÑ€
é€šçµ½å¾€ããõ€”ˆƒâ‰ªƒè‹¥ƒ‰ã¯ 0644ã€ã‚õ€ƒè‹¥ƒŠã¯ root.tty ãÑ‚ã‚‹ã€‚
ã“ãõ€”ˆƒ‡ãƒã‚ã‚ƒ‚é´»ƒ•ã‚ï¼œ‚ã‚ƒƒ« (device file) ã¯
çæ†œœõ€‹™ï¼›è…“å†´•ã‚Œãõ€ˆ˜„ã‚‹ç¯õ€”‹ƒæ½Ÿ‚æ½Ÿƒæ½Ÿ‚ç´”ƒè‹¥ƒõ€²õ€ºæœõ€®õ€”ˆƒï¼œƒâ‰ªƒõ€‚’å‚ç…Ñ™ã‚‹ã€‚
.LP
\fB/dev/vcs[1\-63]\fP ãõ€•§çš¿æƒæ½Ÿ‚æ½Ÿƒæ½Ÿ‚ç´”ƒè‹¥ƒõ€²õ€ºæœõ€®õ€”ˆŸã‚ã®
ã‚õ€’ªƒï½ƒƒõ€Œ²‚õ€•¦‚å¸¥ƒè‹¥ƒ‡ãƒã‚ã‚ƒ‚é´»Ñ€ãƒï¼œ‚å¾ƒï½ƒƒè‹¥ƒŠãƒæ½Ÿƒãƒè‹¥Œ 7ã€ãƒã‚ã‚ƒƒŠãƒè‹¥ƒŠãƒæ½Ÿƒãƒè‹¥Œ 1 ã‹ã‚‰ 63ã€
é€šçµ½å¾õ€•¦ƒâ‰ªƒè‹¥ƒ‰ãŒ 0644ã€ã‚õ€ƒè‹¥ƒŠãƒè‹¥Œ root.tty ãÑ‚ã‚‹ã€‚
\fB/dev/vcsa[0\-63]\fP ã¯ \fB/dev/vcs[1\-63]\fP ãõ€‹–Œç½•˜ãÑ‚ã‚‹ãŒã€
çµ®æ€Ñ‚’æ ä¸»´ã™ã‚‹ãõ€”ˆ« (ãƒ›ã‚é´»ƒˆãƒã‚ã‚ƒƒˆã‚õ€ƒè‹¥ƒ€ã®)
.I "unsigned short"
ã‚’ç¯ç¡”õ€‹”—ãõ€ˆ˜„ã‚‹ç‚é´»€ã‚é´»‚õ€•¦ƒõ€ƒè‹¥ƒæ½Ÿõ€”ˆ‚æ³£‚ã‚ƒ‚å†´ƒç¥‰‚õ€®ƒè‹¥‚ç´”ƒõ€®õ€”‰½è‡€õ€”ˆ‚’èŒµõ€‹”™
4 ãƒã‚ã‚ƒƒˆãõ€”‹ƒ…å ±
\fIlines\fP, \fIcolumns\fP, \fIx\fP, \fIy\fP
(\fIx\fP =\fIy\fP = 0 ãŒç”è„‚â‰ªõ€”Šçªªç­Š) ãŒå…ˆé õ€’ªõ€®‚ã‚‹ç‚é´»Œç•é•õ€‚‹ã€‚

512 æ–‡çµ–—ã‹ã‚‰æˆã‚‹ãƒ•ã‚õ€Œ²ƒæ½Ÿƒˆã‚’ãƒõ€’ªƒè‹¥ƒ‰ã—ãŸå ç¿«ˆã€
9 ãƒ“ãƒƒãƒˆç›õ€”ˆõ€”‹ƒ…å å®´¯ \fI/dev/tty[1\-63]\fP ãõ€°õ€•ã—ã¦
.BR ioctl (2)
\fBVT_GETHIFONTMASK\fP æ“ç¯œã‚’èŒµŒã†ã“ãõ€‹”Ñƒ–ç·‡—ãÑã‚‹
(\fBVT_GETHIFONTMASK\fP æ“ç¯œãõ€•¦‚õ€®ƒè‹¥ƒãƒ« 2.6.18 ç¯ãƒ©™ã® Linux ã§
åˆõ€Œ¶”õ€‹–õˆ•«ƒç´”Ñ‚ã‚‹)ã€‚
å€ã‚ƒ¯
.BR ioctl (2)
ã® 3 ç•õ€”›õ€”ˆõ€”Š¼•ãæ•é•ŒæŒ‡ã™
.I "unsigned short"
ãõ€± ä¸»´ã•ã‚Œãõ€ˆ¿”ã•ã‚Œã‚‹ã€‚
.PP
ã“ã‚Œã‚‰ãõ€”ˆƒ‡ãƒã‚ã‚ƒ‚é´»¯
.BR console (4)
ã® screendump
.BR ioctl (2)
ã‚’ç¯ï½†›å¸¥õ€‹”õ€‚‹ã€‚
ç·‡“ãï½ƒõ€ˆ˜€ã‚æ¿€‚é´»ƒ†ãƒ è†Šâˆ†è€…ãõ€•¦ƒ•ã‚ï¼œ‚ã‚ƒƒõ€®‚æ¿€‚é´»ƒ†ãƒ ãƒ‘ãƒè‹¥ƒŸãƒƒã‚æ¿€ƒÑƒ³
(filesystem permission) ã‚’ç¯å¸¥ï½ƒõ€ˆ˜‚â‰ª‚õ€•¦‚ç¥‰‚é´»‚’ã‚æ½Ÿƒæ½Ÿƒˆãƒõ€’ªƒè‹¥ƒõ€®Ñã‚‹ã€‚
.PP
æœ€åˆã® 8 ãã‚ƒõ€”‰çš¿æƒæ‹¬õ€ºæœõ€®õ€”ˆŸã‚ãõ€”ˆƒ‡ãƒã‚ã‚ƒ‚é´»õ€•¦€ç½¨ï¼œõ€”ˆ‚ˆã†ãõ€®—ãõ€ˆ™½œã‚‹ç¯‹‹ãŒãÑã‚‹:

.nf
    for x in 0 1 2 3 4 5 6 7 8; do
        mknod \-m 644 /dev/vcs$x c 7 $x;
        mknod \-m 644 /dev/vcsa$x c 7 $[$x+128];
    done
    chown root:tty /dev/vcs*
.fi

.BR ioctl (2)
ãõ€®‚ˆã‚‹è€ç¾†‚ãõ€•¦‚æ³£ƒãƒè‹¥ƒˆã•ã‚Œãõ€„ã€‚
.SH ãƒ•ã‚ï¼œ‚ã‚ƒƒ«
/dev/vcs[0\-63]
.br
/dev/vcsa[0\-63]
.\" .SH è‘—è€…
.\" Andries Brouwer <aeb@cwi.nl>
.SH ãƒãƒè‹¥‚å¾ƒÑƒ³
Linux ã‚õ€®ƒè‹¥ƒãƒõ€®ƒãƒè‹¥‚å¾ƒÑƒ³ 1.1.92 ãÑƒ°å…ãƒ£•ã‚ŒãŸã€‚
.SH ç®´‹
vt3 ãõ€”ˆ‚é´»‚õ€•¦ƒõ€ƒè‹¥ƒæ½Ÿƒ€ãƒæ½Ÿƒ—ã‚’çµŸèŒµŒã™ã‚‹ãõ€®õ€•¦€è…´õ€•©œõ€®‚’ vt1 ãõ€°ˆ‡æ›å¸¥ˆã¦
\fIcat /dev/vcs3 >foo\fP ãõ€‹”‚å¸¥‚ã‚ƒƒ—ã™ã‚Œãé•‚ˆã„ã€‚
ç¾‚—ã‚’ç¯˜ã‘ãõ€ˆ›õ€›ã—ã„ãõ€”ˆõ€•¦€ã“ãõ€”Š‡é˜ªŠ›ãõ€•©”å£•¡Œæ–‡çµ–— (newline character) ã‚’
åõ€®‚“ãÑ„ãõ€„ãõ€‹”„ã†ç¯‹‹ãÑ‚ã‚‹ã€‚
ç·‡“ãï½ƒõ€ˆ˜€\fIfold \-w 81 /dev/vcs3 | lpr\fP ã‚„
(ããï½ƒõ€‹”™ã‚‹ãŒ) \fIsetterm \-dump 3 \-file /proc/self/fd/1\fP ãõ€”ˆ‚ˆã†ãª
ç¯•ã‚‰ã‹ãõ€”Š‡õ€ˆœ†ãŒç¶½…è€ãõ€®õ€‚‹ã‹ã‚‚ã—ã‚Œãõ€„ã€‚
.LP
\fI/dev/vcsa0\fP ãƒ‡ãƒã‚ã‚ƒ‚é´»‚’ç¯å¸¥†ã“ãõ€‹”Ñ€
ãƒ–ãƒõ€Œ²‚ã‚ƒƒõ€ˆœ‚åŠ«­—ã‚’ã‚æ³£ƒãƒè‹¥ƒˆã™ã‚‹ã“ãõ€‹”ŒãÑã‚‹ã€‚

ç¯ãƒ¤¸‹ãõ€”ˆƒ—ãƒõ€’ª‚é•ƒõ€Œ²ƒ ãõ€•§ºŒãã‚‡›õ€”ˆõ€”‰çš¿æƒæ½Ÿ‚æ½Ÿƒæ½Ÿ‚ç´”ƒè‹¥ƒõ€®õ€”ˆ‚õ€®ƒè‹¥‚ç´”ƒõ€¯½è‡€õ€”ˆõ€”ˆ‚é´»‚õ€•¦ƒõ€ƒè‹¥ƒå–±æ€Ñõ€‹—–‡çµ–—
ã‚’èŒµõ€‹˜ãšã—ãŸç·‡Œã€ã‚õ€®ƒè‹¥‚ç´”ƒõ€¯½è‡€õ€”ˆõ€”ƒŒæ™õ€•«‰èšŠ‚’ç´Š‰æ›çœ¼™ã‚‹ :

.nf
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>
#include <fcntl.h>
#include <sys/ioctl.h>
#include <linux/vt.h>

int
main(void)
{
    int fd;
    char *device = "/dev/vcsa2";
    char *console = "/dev/tty2";
    struct {unsigned char lines, cols, x, y;} scrn;
    unsigned short s;
    unsigned short mask;
    unsigned char ch, attrib;

    fd = open(console, O_RDWR);
    if (fd < 0) {
        perror(console);
        exit(EXIT_FAILURE);
    }
    if (ioctl(fd, VT_GETHIFONTMASK, &mask) < 0) {
        perror("VT_GETHIFONTMASK");
        exit(EXIT_FAILURE);
    }
    (void) close(fd);
    fd = open(device, O_RDWR);
    if (fd < 0) {
        perror(device);
        exit(EXIT_FAILURE);
    }
    (void) read(fd, &scrn, 4);
    (void) lseek(fd, 4 + 2*(scrn.y*scrn.cols + scrn.x), 0);
    (void) read(fd, &s, 2);
    ch = s & 0xff;
    if (attrib & mask)
        ch |= 0x100;
    attrib = ((s & ~mask) >> 8);
    printf("ch=\(aq%c\(aq attrib=0x%02x\\n", ch, attrib);
    attrib ^= 0x10;
    (void) lseek(fd, \-1, 1);
    (void) write(fd, &attrib, 1);
    exit(EXIT_SUCCESS);
}
.fi
.SH é–âˆ«€ï½‰ …ç›®
.BR console (4),
.BR tty (4),
.BR ttyS (4),
.BR gpm (8)
